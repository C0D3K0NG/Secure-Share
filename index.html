<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureShare | Zero-Trust Vault</title>
    <style>
        :root {
            --bg: #0a0a0a;
            --card: #161616;
            --text: #e0e0e0;
            --primary: #00ff9d; /* Hacker Green */
            --error: #ff4d4d;
        }
        body {
            font-family: 'Courier New', monospace;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            background: var(--card);
            padding: 2rem;
            border-radius: 8px;
            border: 1px solid #333;
            width: 400px;
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.1);
        }
        h1 { color: var(--primary); text-align: center; margin-top: 0; }
        label { display: block; margin-top: 1rem; font-size: 0.9rem; color: #888; }
        
        input, button {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            background: #222;
            border: 1px solid #444;
            color: white;
            font-family: inherit;
            box-sizing: border-box;
        }
        button {
            margin-top: 20px;
            background: var(--primary);
            color: black;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }
        button:hover { opacity: 0.8; }
        
        .result-box {
            margin-top: 20px;
            padding: 10px;
            background: #111;
            border: 1px dashed #444;
            display: none; /* Hidden by default */
            word-break: break-all;
        }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; border-bottom: 2px solid #333; }
        .tab.active { border-bottom: 2px solid var(--primary); color: var(--primary); }
    </style>
</head>
<body>

    <div class="container">
        <h1>üõ°Ô∏è SecureShare</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('upload')">Upload</div>
            <div class="tab" onclick="switchTab('access')">Access</div>
        </div>

        <div id="upload-section">
            <label>Select File (Max 5MB)</label>
            <input type="file" id="fileInput">

            <label>Max Access Count (e.g. 1)</label>
            <input type="number" id="maxViews" value="1" min="1">

            <label>Expiry (Minutes)</label>
            <input type="number" id="expiryMins" value="60" min="1">

            <button onclick="uploadFile()">Generate Secure Link üîí</button>
        </div>

        <div id="access-section" style="display:none;">
            <label>Paste Share ID</label>
            <input type="text" id="shareIdInput" placeholder="uuid-goes-here">
            
            <button onclick="accessFile()">Unlock File üîì</button>
        </div>

        <div id="status" class="result-box"></div>
    </div>

    <script>
        // Use localhost for now (we change this after deploying)
        const API_URL = "http://127.0.0.1:5000"; 

        function switchTab(tab) {
            document.getElementById('upload-section').style.display = tab === 'upload' ? 'block' : 'none';
            document.getElementById('access-section').style.display = tab === 'access' ? 'block' : 'none';
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('status').style.display = 'none';
        }

        async function uploadFile() {
            const file = document.getElementById('fileInput').files[0];
            const maxViews = document.getElementById('maxViews').value;
            const expiry = document.getElementById('expiryMins').value;
            const statusDiv = document.getElementById('status');

            if (!file) { alert("Please select a file!"); return; }

            statusDiv.style.display = 'block';
            statusDiv.innerHTML = "Encrypting & Uploading... ‚è≥";
            statusDiv.style.color = "#ccc";

            const formData = new FormData();
            formData.append("file", file);
            formData.append("max_views", maxViews);
            formData.append("expiry_mins", expiry);

            try {
                const res = await fetch(`${API_URL}/upload`, {
                    method: "POST",
                    body: formData
                });
                const data = await res.json();

                if (res.ok) {
                    statusDiv.innerHTML = `
                        <strong style="color:var(--primary)">SUCCESS!</strong><br><br>
                        Share ID (Copy this):<br>
                        <code style="color:yellow">${data.share_link}</code>
                    `;
                } else {
                    throw new Error(data.error);
                }
            } catch (err) {
                statusDiv.innerHTML = `<span style="color:var(--error)">Error: ${err.message}</span>`;
            }
        }

        async function accessFile() {
            const shareId = document.getElementById('shareIdInput').value;
            const statusDiv = document.getElementById('status');

            statusDiv.style.display = 'block';
            statusDiv.innerHTML = "Verifying Access Policy... üïµÔ∏è";

            try {
                const res = await fetch(`${API_URL}/access/${shareId}`);
                const data = await res.json();

                if (res.ok) {
                    statusDiv.innerHTML = `
                        <strong style="color:var(--primary)">ACCESS GRANTED</strong><br>
                        Views Left: ${data.views_left}<br><br>
                        <a href="${data.file_url}" target="_blank" style="color:cyan; text-decoration:underline;">Click to Download File</a>
                    `;
                } else {
                    statusDiv.innerHTML = `<strong style="color:var(--error)">ACCESS DENIED</strong><br>Reason: ${data.error}`;
                }
            } catch (err) {
                statusDiv.innerHTML = `<span style="color:var(--error)">Error: ${err.message}</span>`;
            }
        }
    </script>
</body>
</html>